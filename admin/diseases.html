<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Diseases - MedLocator</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Additional styles for the admin table */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .admin-table th, .admin-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .admin-table th {
            background-color: #f2f2f2;
            font-weight: 600;
        }
        
        .admin-table tr:hover {
            background-color: #f5f5f5;
        }
        
        .table-actions {
            white-space: nowrap;
        }
        
        .btn {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            margin-right: 5px;
        }
        
        .btn.edit {
            background-color: #4CAF50;
            color: white;
            border: none;
        }
        
        .btn.delete {
            background-color: #f44336;
            color: white;
            border: none;
        }
        
        .form-container {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .form-group {
            flex: 1;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group textarea {
            min-height: 100px;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn.primary {
            background-color: #007bff;
            color: white;
            border: none;
        }
        
        .btn.secondary {
            background-color: #6c757d;
            color: white;
            border: none;
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <div class="container">
            <div class="logo">
                <h1>MedLocator Admin</h1>
            </div>
            <nav class="admin-nav">
                <ul>
                    <li><a href="index.html">Dashboard</a></li>
                    <li><a href="hospitals.html">Hospitals</a></li>
                    <li><a href="diseases.html" class="active">Diseases</a></li>
                    <li><a href="#" id="logout-btn">Logout</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="admin-main container">
        <h2>Manage Diseases</h2>
        
        <div class="form-container">
            <h3>Add/Edit Disease</h3>
            <form id="disease-form">
                <input type="hidden" id="disease-id">
                <div class="form-group">
                    <label for="disease-name">Disease Name</label>
                    <input type="text" id="disease-name" required>
                </div>
                
                <div class="form-group">
                    <label for="disease-description">Description</label>
                    <textarea id="disease-description" rows="4"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn secondary" id="cancel-btn">Cancel</button>
                    <button type="submit" class="btn primary">Save Disease</button>
                </div>
            </form>
        </div>
        
        <h3>All Diseases</h3>
        <table class="admin-table" id="diseases-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Disease Name</th>
                    <th>Hospital Count</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Diseases will be loaded here by JavaScript -->
            </tbody>
        </table>
    </main>

    <script>
        // Sample data for hospitals (same as in your main app)
        const hospitals = [
            {
                id: 1,
                name: "Metro Manila General Hospital",
                address: "123 Health Avenue, Quezon City, Metro Manila",
                phone: "+63 2 123 4567",
                email: "info@mmgh.com",
                website: "www.mmgh.com",
                description: "A leading general hospital in Metro Manila with specialized departments for various conditions.",
                specialties: ["diabetes", "heart disease", "cancer", "asthma"],
                rating: 4.5,
                distance: "2.5 km",
                image: "images/hospital1.jpg",
                hours: "Monday-Friday: 8:00 AM - 5:00 PM\nEmergency: 24/7",
                latitude: 14.6762,
                longitude: 121.0439
            },
            {
                id: 2,
                name: "Cebu City Medical Center",
                address: "456 Wellness Street, Cebu City, Cebu",
                phone: "+63 32 234 5678",
                email: "contact@cebumed.com",
                website: "www.cebumed.com",
                description: "Modern medical facility in Cebu specializing in chronic disease management.",
                specialties: ["diabetes", "kidney disease", "arthritis"],
                rating: 4.2,
                distance: "5.1 km",
                image: "images/hospital2.jpg",
                hours: "Monday-Saturday: 7:00 AM - 7:00 PM\nEmergency: 24/7",
                latitude: 10.3157,
                longitude: 123.8854
            },
            {
                id: 3,
                name: "Davao Regional Hospital",
                address: "789 Care Boulevard, Davao City, Davao del Sur",
                phone: "+63 82 345 6789",
                email: "support@davaoregional.com",
                website: "www.davaoregional.com",
                description: "Comprehensive healthcare services with focus on rare diseases and specialized treatments.",
                specialties: ["cancer", "rare diseases", "heart disease"],
                rating: 4.7,
                distance: "1.8 km",
                image: "images/hospital3.jpg",
                hours: "Monday-Friday: 7:30 AM - 4:30 PM\nEmergency: 24/7",
                latitude: 7.1907,
                longitude: 125.4553
            },
            {
                id: 4,
                name: "Baguio Health Institute",
                address: "101 Mountain View Road, Baguio City, Benguet",
                phone: "+63 74 456 7890",
                email: "info@baguiohealth.com",
                website: "www.baguiohealth.com",
                description: "Specialized hospital in the cool climate of Baguio, ideal for respiratory conditions.",
                specialties: ["asthma", "allergies", "respiratory diseases"],
                rating: 4.3,
                distance: "8.3 km",
                image: "images/hospital4.jpg",
                hours: "Monday-Sunday: 8:00 AM - 6:00 PM\nEmergency: 24/7",
                latitude: 16.4023,
                longitude: 120.5960
            }
        ];

        // DOM Elements
        const diseasesTable = document.getElementById('diseases-table');
        const diseaseForm = document.getElementById('disease-form');
        const cancelBtn = document.getElementById('cancel-btn');
        const logoutBtn = document.getElementById('logout-btn');

        // Current editing state
        let editingDiseaseName = null;
        let diseasesList = [];

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Extract all unique diseases from hospitals
            updateDiseasesList();
            loadDiseasesTable();
            
            // Set up form submission
            diseaseForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveDisease();
            });
            
            // Set up cancel button
            cancelBtn.addEventListener('click', resetForm);
            
            // Set up logout button
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    // In a real app, you would clear the session/token
                    alert('Logged out successfully');
                    window.location.href = '../login.html';
                });
            }
        });

        // Extract all unique diseases from hospitals and update diseasesList
        function updateDiseasesList() {
            const diseasesSet = new Set();
            hospitals.forEach(hospital => {
                hospital.specialties.forEach(disease => {
                    diseasesSet.add(disease);
                });
            });
            diseasesList = Array.from(diseasesSet).map(disease => ({
                name: disease,
                description: '' // Placeholder for description
            }));
        }

        // Count how many hospitals specialize in a given disease
        function countHospitalsForDisease(diseaseName) {
            return hospitals.filter(hospital => 
                hospital.specialties.includes(diseaseName)
            ).length;
        }

        // Load diseases into the table
        function loadDiseasesTable() {
            const tbody = diseasesTable.querySelector('tbody');
            tbody.innerHTML = '';
            
            diseasesList.forEach((disease, index) => {
                const hospitalCount = countHospitalsForDisease(disease.name);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${disease.name}</td>
                    <td>${hospitalCount}</td>
                    <td class="table-actions">
                        <button class="btn edit" data-name="${disease.name}"><i class="fas fa-edit"></i> Edit</button>
                        <button class="btn delete" data-name="${disease.name}"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.btn.edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const name = this.getAttribute('data-name');
                    editDisease(name);
                });
            });
            
            document.querySelectorAll('.btn.delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const name = this.getAttribute('data-name');
                    if (confirm(`Are you sure you want to delete "${name}"? This will remove it from all hospital specialties.`)) {
                        deleteDisease(name);
                    }
                });
            });
        }

        // Edit disease
        function editDisease(name) {
            const disease = diseasesList.find(d => d.name === name);
            if (!disease) return;
            
            editingDiseaseName = name;
            
            // Fill the form with disease data
            document.getElementById('disease-name').value = disease.name;
            document.getElementById('disease-description').value = disease.description || '';
            
            // Scroll to form
            document.querySelector('.form-container').scrollIntoView({ behavior: 'smooth' });
        }

        // Save disease (add or update)
        function saveDisease() {
            const name = document.getElementById('disease-name').value.trim();
            const description = document.getElementById('disease-description').value.trim();
            
            if (!name) {
                alert('Disease name is required');
                return;
            }
            
            if (editingDiseaseName) {
                // Update existing disease
                const index = diseasesList.findIndex(d => d.name === editingDiseaseName);
                if (index !== -1) {
                    // Update disease in diseasesList
                    diseasesList[index] = { name, description };
                    
                    // Update disease in all hospital specialties
                    hospitals.forEach(hospital => {
                        const specIndex = hospital.specialties.indexOf(editingDiseaseName);
                        if (specIndex !== -1) {
                            hospital.specialties[specIndex] = name;
                        }
                    });
                }
            } else {
                // Add new disease
                if (diseasesList.some(d => d.name.toLowerCase() === name.toLowerCase())) {
                    alert('This disease already exists');
                    return;
                }
                diseasesList.push({ name, description });
            }
            
            // Reload table and reset form
            loadDiseasesTable();
            resetForm();
            
            alert('Disease saved successfully!');
        }

        // Delete disease
        function deleteDisease(name) {
            // Remove from diseases list
            diseasesList = diseasesList.filter(d => d.name !== name);
            
            // Remove from all hospital specialties
            hospitals.forEach(hospital => {
                hospital.specialties = hospital.specialties.filter(spec => spec !== name);
            });
            
            // Reload table
            loadDiseasesTable();
            alert(`"${name}" has been deleted from all records`);
        }

        // Reset the form
        function resetForm() {
            diseaseForm.reset();
            document.getElementById('disease-id').value = '';
            editingDiseaseName = null;
        }
    </script>
</body>
</html>